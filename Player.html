<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Clipfy Player</title>

  <!-- Static Twitter Card meta (good default). For perfect per-video meta you will later create server-side pages. -->
  <meta name="twitter:card" content="player">
  <meta name="twitter:site" content="@YourTwitterHandle"> <!-- replace -->
  <meta name="twitter:title" content="Clipfy Video">
  <meta name="twitter:description" content="Watch videos inline on Twitter">
  <meta name="twitter:image" content="https://clipfy.store/default-thumb.jpg"> <!-- replace/upload -->
  <meta name="twitter:player" content="https://clipfy.store/Player.html">
  <meta name="twitter:player:width" content="920">
  <meta name="twitter:player:height" content="520">

  <style>
    :root { --maxw:920px; --player-h:520px; --ads-h:250px; }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:Inter, Roboto, Arial, sans-serif;
      background:#ffffff;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:20px 10px;
    }

    .container{
      width:100%;
      max-width:var(--maxw);
    }

    /* Video fixed box */
    #player-wrap{
      width:100%;
      background:#000;
      border-radius:6px;
      overflow:hidden;
      box-shadow:0 6px 18px rgba(0,0,0,0.08);
    }
    video{
      width:100%;
      height:var(--player-h); /* fixed height so layout doesn't jump */
      display:block;
      background:#000;
    }

    /* Ads area fixed */
    #ads-area{
      width:100%;
      min-height:var(--ads-h);
      margin-top:18px;
      background:#fafafa;
      border:1px solid #e6e6e6;
      border-radius:6px;
      display:flex;
      align-items:center;
      justify-content:center;
      color:#444;
      padding:10px;
    }

    /* Small responsive adjustments */
    @media (max-width:640px){
      :root { --maxw:640px; --player-h:360px; --ads-h:200px; }
      body{ padding:12px 8px; }
    }

    .meta-note{
      font-size:13px;
      color:#666;
      margin-top:10px;
      text-align:center;
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- Player -->
    <div id="player-wrap" aria-hidden="false">
      <video id="player" controls playsinline webkit-playsinline poster="">
        <!-- source will be injected by JS from ?video= param -->
        Your browser does not support HTML5 video.
      </video>
    </div>

    <!-- Ads area (paste ad network script / iframe here) -->
    <div id="ads-area">
      <!-- Replace this with your ad network code (Adsterra / Propeller / Adsense). -->
      <div id="ad-placeholder">
        <strong>Advertisement</strong><br>
        Paste ad network script or banner code into the <code>#ads-area</code> div.
      </div>
    </div>

    <div class="meta-note">
      Tip: use links like <code>?video=&lt;url-encoded-file-url&gt;&amp;thumb=&lt;url-encoded-thumb-url&gt;</code>
    </div>
  </div>

  <script>
    (function(){
      const params = new URLSearchParams(location.search);
      const v = params.get('video');
      const t = params.get('thumb') || '';
      const player = document.getElementById('player');

      // Helper: safe decode and ensure protocol
      function safeDecode(s){
        if(!s) return '';
        try { return decodeURIComponent(s); } catch(e) { return s; }
      }

      const videoUrl = safeDecode(v);
      const thumbUrl = safeDecode(t);

      if (thumbUrl) player.setAttribute('poster', thumbUrl);

      // Clear previous sources (important for reloads)
      while (player.firstChild) player.removeChild(player.firstChild);

      if (videoUrl) {
        // If the url is an m3u8 or mp4 we don't transcode here; we attach as <source>
        const ext = videoUrl.split('.').pop().split('?')[0].toLowerCase();
        const source = document.createElement('source');
        source.src = videoUrl;
        // choose basic type
        if (ext === 'm3u8') source.type = 'application/vnd.apple.mpegurl';
        else source.type = 'video/mp4';
        player.appendChild(source);
        // Add fallback text
        player.appendChild(document.createTextNode('Your browser does not support HTML5 video.'));
      } else {
        document.getElementById('player-wrap').innerHTML =
          "<div style='color:#fff;padding:40px;text-align:center;'>No video specified. Example test link:<br><code>https://clipfy.store/Player.html?video=https://pub-51338658718349efb6e5193255e41.r2.dev/Video_Of_Hugging_And_Dancing.mp4</code></div>";
        return;
      }

      // Analytics beacons (very small): change /pixel endpoints later
      player.addEventListener('play', ()=>{
        try {
          navigator.sendBeacon('/pixel/played', JSON.stringify({video: videoUrl, t: Date.now()}));
        } catch(e){}
      });
      player.addEventListener('ended', ()=>{
        try {
          navigator.sendBeacon('/pixel/completed', JSON.stringify({video: videoUrl, t: Date.now()}));
        } catch(e){}
      });

      // Prevent page scroll jump when controls focused on mobile (optional UX)
      player.addEventListener('touchstart', ()=>{}, {passive:true});
    })();
  </script>
</body>
</html>
